"use strict";module.exports=function(s){require("source-map-support").install();var r=require("./modbus-basics"),a=require("./core/modbus-core"),t=require("./core/modbus-io-core"),u=require("debug")("contribModbus:getter");s.nodes.registerType("modbus-getter",function(e){s.nodes.createNode(this,e),this.name=e.name,this.unitid=e.unitid,this.dataType=e.dataType,this.adr=e.adr,this.quantity=e.quantity,this.showStatusActivities=e.showStatusActivities,this.showErrors=e.showErrors,this.msgThruput=e.msgThruput,this.connection=null,this.useIOFile=e.useIOFile,this.ioFile=s.nodes.getNode(e.ioFile),this.useIOForPayload=e.useIOForPayload,this.logIOActivities=e.logIOActivities,this.emptyMsgOnFail=e.emptyMsgOnFail,this.keepMsgProperties=e.keepMsgProperties,this.internalDebugLog=u,this.verboseLogging=s.settings.verbose;var o=this,i=(o.bufferMessageList=new Map,r.setNodeStatusTo("waiting",o),s.nodes.getNode(e.server));i&&(i.registerForModbus(o),r.initModbusClientEvents(o,i),o.onModbusCommandDone=function(e,s){o.showStatusActivities&&r.setNodeStatusTo("reading done",o),o.send(t.buildMessageWithIO(o,e.data,e,s)),o.emit("modbusGetterNodeDone")},o.errorProtocolMsg=function(e,s){o.showErrors&&r.logMsgError(o,e,s)},o.onModbusCommandError=function(e,s){o.internalDebugLog(e.message);var t=a.getOriginalMessage(o.bufferMessageList,s);o.errorProtocolMsg(e,t),r.sendEmptyMsgOnFail(o,e,s),r.setModbusError(o,i,e,t),o.emit("modbusGetterNodeError")},o.buildNewMessageObject=function(e,s){var t=a.getObjectId();return{topic:s.topic||e.id,messageId:t,payload:{value:s.payload.value||s.payload,unitid:e.unitid,fc:a.functionCodeModbusRead(e.dataType),address:e.adr,quantity:e.quantity,messageId:t}}},o.on("input",function(s){if(!r.invalidPayloadIn(s)&&i.client){s=Object.assign({},s);try{var e=o.buildNewMessageObject(o,s);o.bufferMessageList.set(e.messageId,r.buildNewMessage(o.keepMsgProperties,s,e)),i.emit("readModbus",e,o.onModbusCommandDone,o.onModbusCommandError),o.showStatusActivities&&r.setNodeStatusTo(i.actualServiceState,o)}catch(e){o.errorProtocolMsg(e,s),r.sendEmptyMsgOnFail(o,e,s)}}}),o.on("close",function(e){r.setNodeStatusTo("closed",o),o.bufferMessageList.clear(),i.deregisterForModbus(o.id,e)}),o.showStatusActivities||r.setNodeDefaultStatus(o))})};
//# sourceMappingURL=maps/modbus-getter.js.map
